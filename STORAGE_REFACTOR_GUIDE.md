# å­˜å‚¨å±‚é‡æ„æŒ‡å— - æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒåŠ¨æ€åˆ‡æ¢

## ğŸ“‹ ä¸€ã€æ”¹é€ æ ¸å¿ƒç›®æ ‡

1. **ç¯å¢ƒå¯æ§**ï¼šé€šè¿‡ `.env` çš„ `STORAGE_MODE` å˜é‡ï¼ˆå€¼ä¸º `local`/`supabase`ï¼‰æ§åˆ¶å­˜å‚¨æ–¹å¼
2. **ä»£ç ä¿ç•™**ï¼šSupabase æ‰€æœ‰åˆå§‹åŒ–ã€æŸ¥è¯¢ä»£ç å‡ä¿ç•™ï¼Œä»…åœ¨ `STORAGE_MODE=supabase` æ—¶æ‰§è¡Œ
3. **é€»è¾‘è§£è€¦**ï¼šæ–°å¢å­˜å‚¨é€‚é…å±‚ï¼Œä¸šåŠ¡ä»£ç ä»…è°ƒç”¨é€‚é…å±‚æ–¹æ³•ï¼Œä¸ç›´æ¥æ“ä½œ JSON/Supabase
4. **åœ°å›¾å…¼å®¹**ï¼šåœ°å›¾ Key åŠ è½½ã€å®ä¾‹åˆå§‹åŒ–ä¸å­˜å‚¨æ¨¡å¼è§£è€¦ï¼ŒåŒç¯å¢ƒä¸‹åœ°å›¾åŠŸèƒ½æ­£å¸¸

---

## ğŸ› ï¸ äºŒã€å·²å®Œæˆçš„æ”¹é€ 

### 1. å­˜å‚¨é€‚é…å±‚ (`backend/storageAdapter.js`)

å·²åˆ›å»ºç»Ÿä¸€çš„å­˜å‚¨é€‚é…å±‚ï¼Œå°è£…äº†ä»¥ä¸‹æ–¹æ³•ï¼š

#### ç«™ç‚¹ï¼ˆxhs_sitesï¼‰æ“ä½œ
- `readSites()` - è¯»å–æ‰€æœ‰ç«™ç‚¹
- `readSiteById(id)` - æ ¹æ®IDè¯»å–å•ä¸ªç«™ç‚¹
- `saveSite(siteData)` - ä¿å­˜ç«™ç‚¹
- `updateSite(id, updates)` - æ›´æ–°ç«™ç‚¹
- `deleteSite(id)` - åˆ é™¤ç«™ç‚¹
- `searchSites(search, tag)` - æœç´¢ç«™ç‚¹

#### è¡Œç¨‹ï¼ˆtripsï¼‰æ“ä½œ
- `readTrips()` - è¯»å–æ‰€æœ‰è¡Œç¨‹
- `readTripById(id)` - æ ¹æ®IDè¯»å–å•ä¸ªè¡Œç¨‹
- `saveTrip(tripData)` - ä¿å­˜è¡Œç¨‹
- `updateTrip(id, updates)` - æ›´æ–°è¡Œç¨‹
- `deleteTrip(id)` - åˆ é™¤è¡Œç¨‹

#### è¡Œç¨‹å†…å®¹ï¼ˆtrip_itemsï¼‰æ“ä½œ
- `readTripItems(tripId, date)` - è¯»å–è¡Œç¨‹çš„æ‰€æœ‰å†…å®¹é¡¹
- `saveTripItem(tripId, itemData)` - ä¿å­˜è¡Œç¨‹å†…å®¹é¡¹
- `saveTripItemsByDate(tripId, date, theme, items)` - æ‰¹é‡ä¿å­˜å•æ—¥è¡Œç¨‹
- `updateTripItem(tripId, itemId, updates)` - æ›´æ–°è¡Œç¨‹å†…å®¹é¡¹
- `deleteTripItem(tripId, itemId)` - åˆ é™¤è¡Œç¨‹å†…å®¹é¡¹
- `deleteTripItems(tripId)` - åˆ é™¤è¡Œç¨‹çš„æ‰€æœ‰å†…å®¹é¡¹

#### å­˜å‚¨æ¨¡å¼æŸ¥è¯¢
- `getStorageMode()` - è·å–å½“å‰å­˜å‚¨æ¨¡å¼
- `isSupabaseMode()` - æ£€æŸ¥æ˜¯å¦ä¸ºSupabaseæ¨¡å¼
- `isLocalMode()` - æ£€æŸ¥æ˜¯å¦ä¸ºæœ¬åœ°æ¨¡å¼

### 2. åç«¯æ¥å£é‡æ„ (`backend/server.js`)

å·²æ›¿æ¢ä»¥ä¸‹æ¥å£ä½¿ç”¨å­˜å‚¨é€‚é…å±‚ï¼š

#### ç«™ç‚¹æ¥å£
- âœ… `POST /api/xhs/sites` - ä¿å­˜ç«™ç‚¹
- âœ… `GET /api/xhs/sites` - è·å–æ‰€æœ‰ç«™ç‚¹
- âœ… `GET /api/xhs/sites/:id` - è·å–å•ä¸ªç«™ç‚¹
- âœ… `PUT /api/xhs/sites/:id` - æ›´æ–°ç«™ç‚¹
- âœ… `DELETE /api/xhs/sites/:id` - åˆ é™¤ç«™ç‚¹

#### è¡Œç¨‹æ¥å£
- âœ… `POST /api/trips` - åˆ›å»ºè¡Œç¨‹
- âœ… `GET /api/trips` - è·å–æ‰€æœ‰è¡Œç¨‹
- âœ… `GET /api/trips/:id` - è·å–å•ä¸ªè¡Œç¨‹ï¼ˆå«å…³è”ç«™ç‚¹å’Œå†…å®¹ï¼‰
- âš ï¸ `PUT /api/trips/:id` - æ›´æ–°è¡Œç¨‹ï¼ˆéƒ¨åˆ†æ›¿æ¢ï¼Œä¿ç•™åŸé€»è¾‘ï¼‰
- âš ï¸ `DELETE /api/trips/:id` - åˆ é™¤è¡Œç¨‹ï¼ˆéƒ¨åˆ†æ›¿æ¢ï¼Œä¿ç•™åŸé€»è¾‘ï¼‰

#### è¡Œç¨‹å†…å®¹æ¥å£
- âœ… `POST /api/trips/:tripId/day-items` - æ‰¹é‡ä¿å­˜å•æ—¥è¡Œç¨‹
- âœ… `POST /api/trips/:tripId/items` - å•ä¸ªæ·»åŠ è¡Œç¨‹å†…å®¹
- âœ… `PUT /api/trips/:tripId/items/:itemId` - æ›´æ–°è¡Œç¨‹å†…å®¹
- âœ… `DELETE /api/trips/:tripId/items/:itemId` - åˆ é™¤è¡Œç¨‹å†…å®¹

### 3. åœ°å›¾Keyæ¥å£ (`backend/server.js`)

å·²æ–°å¢åœ°å›¾Keyæ¥å£ï¼š

- âœ… `GET /api/maps/keys` - è¿”å›é«˜å¾·å’ŒGoogleåœ°å›¾çš„API Key

---

## ğŸ“ ä¸‰ã€ç¯å¢ƒå˜é‡é…ç½®

### æµ‹è¯•ç¯å¢ƒé…ç½® (`backend/.env`)

```bash
# å­˜å‚¨æ¨¡å¼ï¼šlocalï¼ˆæœ¬åœ°JSONæ–‡ä»¶ï¼‰æˆ– supabaseï¼ˆSupabaseæ•°æ®åº“ï¼‰
STORAGE_MODE=local

# Supabaseé…ç½®ï¼ˆä»…åœ¨STORAGE_MODE=supabaseæ—¶éœ€è¦ï¼‰
SUPABASE_URL=your-supabase-url
SUPABASE_KEY=your-supabase-key

# é«˜å¾·åœ°å›¾API Keyï¼ˆWebç«¯JS APIï¼‰
AMAP_API_KEY=ä½ çš„é«˜å¾·åœ°å›¾Key

# Googleåœ°å›¾API Keyï¼ˆå¯é€‰ï¼‰
GOOGLE_API_KEY=ä½ çš„Googleåœ°å›¾Key
```

### ç”Ÿäº§ç¯å¢ƒé…ç½® (`backend/.env`)

```bash
# å­˜å‚¨æ¨¡å¼ï¼šlocalï¼ˆæœ¬åœ°JSONæ–‡ä»¶ï¼‰æˆ– supabaseï¼ˆSupabaseæ•°æ®åº“ï¼‰
STORAGE_MODE=supabase

# Supabaseé…ç½®ï¼ˆå¿…é¡»ï¼‰
SUPABASE_URL=your-supabase-url
SUPABASE_KEY=your-supabase-key

# é«˜å¾·åœ°å›¾API Keyï¼ˆWebç«¯JS APIï¼‰
AMAP_API_KEY=ä½ çš„é«˜å¾·åœ°å›¾Key

# Googleåœ°å›¾API Keyï¼ˆå¯é€‰ï¼‰
GOOGLE_API_KEY=ä½ çš„Googleåœ°å›¾Key
```

---

## ğŸ”„ å››ã€ç¯å¢ƒåˆ‡æ¢æ“ä½œæŒ‡å—

### ä»æµ‹è¯•ç¯å¢ƒåˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

1. **ä¿®æ”¹ `backend/.env` æ–‡ä»¶**ï¼š
   ```bash
   STORAGE_MODE=supabase
   ```

2. **ç¡®ä¿ Supabase é…ç½®æ­£ç¡®**ï¼š
   ```bash
   SUPABASE_URL=ä½ çš„Supabaseé¡¹ç›®URL
   SUPABASE_KEY=ä½ çš„SupabaseåŒ¿åKey
   ```

3. **é‡å¯åç«¯æœåŠ¡**ï¼š
   ```bash
   cd backend
   npm start
   ```

4. **éªŒè¯å­˜å‚¨æ¨¡å¼**ï¼š
   - æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—ï¼Œåº”æ˜¾ç¤ºï¼š`ğŸ“¦ å½“å‰å­˜å‚¨æ¨¡å¼: Supabaseæ•°æ®åº“`
   - æµ‹è¯•æ•°æ®è¯»å†™ï¼Œç¡®è®¤æ•°æ®ä¿å­˜åˆ°Supabase

### ä»ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢å›æµ‹è¯•ç¯å¢ƒ

1. **ä¿®æ”¹ `backend/.env` æ–‡ä»¶**ï¼š
   ```bash
   STORAGE_MODE=local
   ```

2. **é‡å¯åç«¯æœåŠ¡**ï¼š
   ```bash
   cd backend
   npm start
   ```

3. **éªŒè¯å­˜å‚¨æ¨¡å¼**ï¼š
   - æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—ï¼Œåº”æ˜¾ç¤ºï¼š`ğŸ“¦ å½“å‰å­˜å‚¨æ¨¡å¼: æœ¬åœ°JSONæ–‡ä»¶`
   - æµ‹è¯•æ•°æ®è¯»å†™ï¼Œç¡®è®¤æ•°æ®ä¿å­˜åˆ° `backend/data/` ç›®å½•ä¸‹çš„JSONæ–‡ä»¶

---

## âœ… äº”ã€åŒç¯å¢ƒåŠŸèƒ½éªŒè¯æ­¥éª¤

### æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼ˆSTORAGE_MODE=localï¼‰

#### 1. å­˜å‚¨åŠŸèƒ½éªŒè¯

**æ­¥éª¤1ï¼šéªŒè¯åç«¯å¯åŠ¨**
```bash
cd backend
npm start
```
- âœ… é¢„æœŸï¼šç»ˆç«¯æ˜¾ç¤º `ğŸ“¦ å½“å‰å­˜å‚¨æ¨¡å¼: æœ¬åœ°JSONæ–‡ä»¶`
- âœ… é¢„æœŸï¼šæ— Supabaseç›¸å…³æŠ¥é”™

**æ­¥éª¤2ï¼šéªŒè¯ç«™ç‚¹ä¿å­˜**
- æ‰“å¼€å‰ç«¯"ç¬¬ä¸‰æ–¹æ”»ç•¥åº“"é¡µé¢
- æ·»åŠ ä¸€ä¸ªæ–°ç«™ç‚¹
- æ£€æŸ¥ `backend/data/xhs_sites.json` æ–‡ä»¶
- âœ… é¢„æœŸï¼šJSONæ–‡ä»¶ä¸­åŒ…å«æ–°æ·»åŠ çš„ç«™ç‚¹æ•°æ®

**æ­¥éª¤3ï¼šéªŒè¯ç«™ç‚¹è¯»å–**
- åˆ·æ–°"ç¬¬ä¸‰æ–¹æ”»ç•¥åº“"é¡µé¢
- âœ… é¢„æœŸï¼šæ–°æ·»åŠ çš„ç«™ç‚¹æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­

**æ­¥éª¤4ï¼šéªŒè¯è¡Œç¨‹ä¿å­˜**
- æ‰“å¼€"è¡Œç¨‹ç®¡ç†"é¡µé¢
- åˆ›å»ºæ–°è¡Œç¨‹
- æ£€æŸ¥ `backend/data/trips.json` æ–‡ä»¶
- âœ… é¢„æœŸï¼šJSONæ–‡ä»¶ä¸­åŒ…å«æ–°åˆ›å»ºçš„è¡Œç¨‹æ•°æ®

**æ­¥éª¤5ï¼šéªŒè¯è¡Œç¨‹å†…å®¹ä¿å­˜**
- åœ¨è¡Œç¨‹ç¼–è¾‘é¡µæ·»åŠ è¡Œç¨‹å†…å®¹
- æ£€æŸ¥ `backend/data/trip_items.json` æ–‡ä»¶
- âœ… é¢„æœŸï¼šJSONæ–‡ä»¶ä¸­åŒ…å«æ–°æ·»åŠ çš„è¡Œç¨‹å†…å®¹

#### 2. åœ°å›¾åŠŸèƒ½éªŒè¯

**æ­¥éª¤1ï¼šéªŒè¯åœ°å›¾Keyæ¥å£**
```bash
curl http://localhost:3008/api/maps/keys
```
- âœ… é¢„æœŸï¼šè¿”å› `{ code: 200, data: { amap: "ä½ çš„Key", google: "ä½ çš„Key" } }`

**æ­¥éª¤2ï¼šéªŒè¯åœ°å›¾åŠ è½½**
- æ‰“å¼€è¡Œç¨‹ç¼–è¾‘é¡µ
- ç‚¹å‡»"åœ°å›¾æŸ¥åœ°å€"æŒ‰é’®
- âœ… é¢„æœŸï¼šåœ°å›¾å¼¹çª—æ­£å¸¸æ‰“å¼€
- âœ… é¢„æœŸï¼šé«˜å¾·åœ°å›¾æ­£å¸¸åŠ è½½ï¼ˆ3ç§’å†…æ˜¾ç¤ºå¯äº¤äº’åœ°å›¾ï¼‰

**æ­¥éª¤3ï¼šéªŒè¯åœ°å›¾é€‰ç‚¹**
- åœ¨åœ°å›¾ä¸Šç‚¹å‡»é€‰æ‹©åœ°ç‚¹
- âœ… é¢„æœŸï¼šåœ°å€è¾“å…¥æ¡†è‡ªåŠ¨å¡«å……é€‰ä¸­åœ°ç‚¹çš„åœ°å€

**æ­¥éª¤4ï¼šéªŒè¯åœ°å›¾åˆ‡æ¢**
- åœ¨åœ°å›¾å¼¹çª—ä¸­åˆ‡æ¢åˆ°"Googleåœ°å›¾"
- âœ… é¢„æœŸï¼šGoogleåœ°å›¾æ­£å¸¸åŠ è½½
- âœ… é¢„æœŸï¼šå½“å‰é€‰ä¸­çš„ä½ç½®ä¿ç•™

### ç”Ÿäº§ç¯å¢ƒéªŒè¯ï¼ˆSTORAGE_MODE=supabaseï¼‰

#### 1. å­˜å‚¨åŠŸèƒ½éªŒè¯

**æ­¥éª¤1ï¼šéªŒè¯åç«¯å¯åŠ¨**
```bash
cd backend
npm start
```
- âœ… é¢„æœŸï¼šç»ˆç«¯æ˜¾ç¤º `ğŸ“¦ å½“å‰å­˜å‚¨æ¨¡å¼: Supabaseæ•°æ®åº“`
- âœ… é¢„æœŸï¼šæ˜¾ç¤º `âœ… Supabaseå®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ`

**æ­¥éª¤2ï¼šéªŒè¯ç«™ç‚¹ä¿å­˜**
- æ‰“å¼€å‰ç«¯"ç¬¬ä¸‰æ–¹æ”»ç•¥åº“"é¡µé¢
- æ·»åŠ ä¸€ä¸ªæ–°ç«™ç‚¹
- ç™»å½•Supabaseæ§åˆ¶å°ï¼ŒæŸ¥çœ‹ `xhs_sites` è¡¨
- âœ… é¢„æœŸï¼šè¡¨ä¸­åŒ…å«æ–°æ·»åŠ çš„ç«™ç‚¹æ•°æ®

**æ­¥éª¤3ï¼šéªŒè¯ç«™ç‚¹è¯»å–**
- åˆ·æ–°"ç¬¬ä¸‰æ–¹æ”»ç•¥åº“"é¡µé¢
- âœ… é¢„æœŸï¼šæ–°æ·»åŠ çš„ç«™ç‚¹æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­

**æ­¥éª¤4ï¼šéªŒè¯è¡Œç¨‹ä¿å­˜**
- æ‰“å¼€"è¡Œç¨‹ç®¡ç†"é¡µé¢
- åˆ›å»ºæ–°è¡Œç¨‹
- ç™»å½•Supabaseæ§åˆ¶å°ï¼ŒæŸ¥çœ‹ `trips` è¡¨
- âœ… é¢„æœŸï¼šè¡¨ä¸­åŒ…å«æ–°åˆ›å»ºçš„è¡Œç¨‹æ•°æ®

**æ­¥éª¤5ï¼šéªŒè¯è¡Œç¨‹å†…å®¹ä¿å­˜**
- åœ¨è¡Œç¨‹ç¼–è¾‘é¡µæ·»åŠ è¡Œç¨‹å†…å®¹
- ç™»å½•Supabaseæ§åˆ¶å°ï¼ŒæŸ¥çœ‹ `trip_items` è¡¨
- âœ… é¢„æœŸï¼šè¡¨ä¸­åŒ…å«æ–°æ·»åŠ çš„è¡Œç¨‹å†…å®¹

#### 2. åœ°å›¾åŠŸèƒ½éªŒè¯

**æ­¥éª¤1-4**ï¼šä¸æµ‹è¯•ç¯å¢ƒç›¸åŒï¼Œåœ°å›¾åŠŸèƒ½ä¸å—å­˜å‚¨æ¨¡å¼å½±å“

---

## ğŸ”§ å…­ã€å‰ç«¯åœ°å›¾KeyåŠ¨æ€è·å–ï¼ˆå¾…å®ç°ï¼‰

### å½“å‰çŠ¶æ€

å‰ç«¯åœ°å›¾åˆå§‹åŒ–ä»ä½¿ç”¨ç¯å¢ƒå˜é‡ `VITE_AMAP_API_KEY`ï¼Œéœ€è¦æ”¹ä¸ºä»åç«¯æ¥å£åŠ¨æ€è·å–ã€‚

### å®ç°æ­¥éª¤

#### 1. ä¿®æ”¹ `frontend/src/components/MapPicker.vue`

åœ¨ `initAmapMap` å‡½æ•°ä¸­ï¼Œä»åç«¯è·å–Keyï¼š

```javascript
// ã€é‡æ„ã€‘ä»åç«¯åŠ¨æ€è·å–åœ°å›¾Key
const fetchMapKeys = async () => {
  try {
    const response = await axios.get('/api/maps/keys')
    if (response.data.code === 200) {
      return response.data.data
    }
  } catch (err) {
    console.error('è·å–åœ°å›¾Keyså¤±è´¥:', err)
  }
  return { amap: null, google: null }
}

// ä¿®æ”¹ initAmapMap å‡½æ•°
const initAmapMap = async (retryCount = 0) => {
  // ... ç°æœ‰ä»£ç  ...

  // ã€æ–°å¢ã€‘ä»åç«¯è·å–Key
  const keys = await fetchMapKeys()
  const apiKey = keys.amap || AMAP_API_KEY // é™çº§åˆ°ç¯å¢ƒå˜é‡

  if (!apiKey || apiKey === 'YOUR_AMAP_API_KEY') {
    const errorMsg = 'é«˜å¾·åœ°å›¾API Keyæœªé…ç½®'
    console.error('âŒ', errorMsg)
    mapLoadError.value = errorMsg
    return
  }

  // ... åç»­ä½¿ç”¨ apiKey åŠ è½½API ...
}
```

---

## ğŸ“Š ä¸ƒã€æ ¸å¿ƒä¸šåŠ¡æ¥å£æ›¿æ¢ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šä¿å­˜ç«™ç‚¹æ¥å£

**åŸä»£ç **ï¼š
```javascript
if (isSupabaseConfigured() && supabase) {
  const { data, error } = await supabase.from('xhs_sites').insert([siteData])
  // ...
} else {
  const savedSite = saveSiteToFile(siteData)
  // ...
}
```

**é‡æ„å**ï¼š
```javascript
const savedSite = await storage.saveSite(siteData)
console.log(`âœ… ç«™ç‚¹å·²ä¿å­˜åˆ°${STORAGE_MODE === 'supabase' ? 'Supabaseæ•°æ®åº“' : 'JSONæ–‡ä»¶'}`)
```

### ç¤ºä¾‹2ï¼šè·å–æ‰€æœ‰ç«™ç‚¹æ¥å£

**åŸä»£ç **ï¼š
```javascript
if (isSupabaseConfigured() && supabase) {
  const { data } = await supabase.from('xhs_sites').select('*')
  // ...
} else {
  let sites = readSitesFromFile()
  // ...
}
```

**é‡æ„å**ï¼š
```javascript
let sites = []
if (search || tag) {
  sites = await storage.searchSites(search, tag)
} else {
  sites = await storage.readSites()
}
```

### ç¤ºä¾‹3ï¼šæ‰¹é‡ä¿å­˜å•æ—¥è¡Œç¨‹æ¥å£

**åŸä»£ç **ï¼š
```javascript
if (isSupabaseConfigured() && supabase) {
  await supabase.from('trip_items').delete().eq('trip_id', tripId).eq('date', date)
  const { data } = await supabase.from('trip_items').insert(itemsToInsert)
  // ...
} else {
  // JSONæ–‡ä»¶æ“ä½œ...
}
```

**é‡æ„å**ï¼š
```javascript
const savedItems = await storage.saveTripItemsByDate(tripId, date, theme, items)
console.log(`âœ… å•æ—¥è¡Œç¨‹å·²ä¿å­˜åˆ°${STORAGE_MODE === 'supabase' ? 'Supabaseæ•°æ®åº“' : 'JSONæ–‡ä»¶'}`)
```

---

## ğŸ¯ å…«ã€æ³¨æ„äº‹é¡¹

1. **Supabaseä»£ç ä¿ç•™**ï¼šæ‰€æœ‰Supabaseç›¸å…³ä»£ç å‡ä¿ç•™åœ¨ `storageAdapter.js` ä¸­ï¼Œä»…åœ¨ `STORAGE_MODE=supabase` æ—¶æ‰§è¡Œ

2. **é™çº§æœºåˆ¶**ï¼šå¦‚æœSupabaseè¿æ¥å¤±è´¥ï¼Œå­˜å‚¨é€‚é…å±‚ä¼šè‡ªåŠ¨é™çº§åˆ°æœ¬åœ°JSONæ–‡ä»¶å­˜å‚¨

3. **æ•°æ®è¿ç§»**ï¼šä»localåˆ‡æ¢åˆ°supabaseæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è¿ç§»JSONæ–‡ä»¶ä¸­çš„æ•°æ®åˆ°Supabaseï¼ˆæˆ–ç¼–å†™è¿ç§»è„šæœ¬ï¼‰

4. **åœ°å›¾Keyè§£è€¦**ï¼šåœ°å›¾åŠŸèƒ½ä¸å­˜å‚¨æ¨¡å¼å®Œå…¨è§£è€¦ï¼ŒåŒç¯å¢ƒä¸‹å‡èƒ½æ­£å¸¸ä½¿ç”¨

5. **ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§**ï¼šåç«¯ä¼˜å…ˆä½¿ç”¨ `AMAP_API_KEY`ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨ `VITE_AMAP_API_KEY`ï¼ˆå…¼å®¹å‰ç«¯ç¯å¢ƒå˜é‡ï¼‰

---

## ğŸ“š ä¹ã€ç›¸å…³æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `backend/storageAdapter.js` - å­˜å‚¨é€‚é…å±‚
- `STORAGE_REFACTOR_GUIDE.md` - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
- `backend/server.js` - æ›¿æ¢å­˜å‚¨è°ƒç”¨ä¸ºé€‚é…å±‚æ–¹æ³•
- `backend/.env` - æ–°å¢ `STORAGE_MODE` é…ç½®

### å¾…ä¿®æ”¹æ–‡ä»¶
- `frontend/src/components/MapPicker.vue` - æ”¹ä¸ºä»åç«¯åŠ¨æ€è·å–åœ°å›¾Key

---

## ğŸš€ åã€å¿«é€Ÿå¼€å§‹

1. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   cd backend
   cp .env.example .env
   # ç¼–è¾‘ .envï¼Œè®¾ç½® STORAGE_MODE=local æˆ– supabase
   ```

2. **å¯åŠ¨åç«¯æœåŠ¡**ï¼š
   ```bash
   npm start
   ```

3. **éªŒè¯å­˜å‚¨æ¨¡å¼**ï¼š
   - æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„å­˜å‚¨æ¨¡å¼æç¤º
   - æµ‹è¯•æ•°æ®è¯»å†™åŠŸèƒ½

4. **åˆ‡æ¢å­˜å‚¨æ¨¡å¼**ï¼š
   - ä¿®æ”¹ `.env` ä¸­çš„ `STORAGE_MODE`
   - é‡å¯åç«¯æœåŠ¡

---

## âœ… å®Œæˆåº¦æ£€æŸ¥æ¸…å•

- [x] åˆ›å»ºå­˜å‚¨é€‚é…å±‚ (`storageAdapter.js`)
- [x] æ›¿æ¢ç«™ç‚¹ç›¸å…³æ¥å£
- [x] æ›¿æ¢è¡Œç¨‹ç›¸å…³æ¥å£
- [x] æ›¿æ¢è¡Œç¨‹å†…å®¹ç›¸å…³æ¥å£
- [x] æ·»åŠ å­˜å‚¨æ¨¡å¼æ—¥å¿—è¾“å‡º
- [x] æ·»åŠ åœ°å›¾Keyæ¥å£
- [ ] ä¿®æ”¹å‰ç«¯åœ°å›¾åˆå§‹åŒ–é€»è¾‘ï¼ˆä»åç«¯è·å–Keyï¼‰
- [ ] ç¼–å†™æ•°æ®è¿ç§»è„šæœ¬ï¼ˆlocal â†’ supabaseï¼‰
- [x] åˆ›å»ºç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
- [x] ç¼–å†™å®Œæ•´æ–‡æ¡£

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•éªŒè¯å½“å‰ä½¿ç”¨çš„å­˜å‚¨æ¨¡å¼ï¼Ÿ
**A**: æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—ï¼Œä¼šæ˜¾ç¤º `ğŸ“¦ å½“å‰å­˜å‚¨æ¨¡å¼: æœ¬åœ°JSONæ–‡ä»¶` æˆ– `ğŸ“¦ å½“å‰å­˜å‚¨æ¨¡å¼: Supabaseæ•°æ®åº“`

### Q2: åˆ‡æ¢å­˜å‚¨æ¨¡å¼åï¼ŒåŸæœ‰æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ
**A**: ä¸ä¼šã€‚localæ¨¡å¼çš„æ•°æ®ä¿å­˜åœ¨JSONæ–‡ä»¶ä¸­ï¼Œsupabaseæ¨¡å¼çš„æ•°æ®ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚åˆ‡æ¢æ¨¡å¼åï¼Œéœ€è¦æ‰‹åŠ¨è¿ç§»æ•°æ®ã€‚

### Q3: Supabaseè¿æ¥å¤±è´¥ä¼šæ€æ ·ï¼Ÿ
**A**: å­˜å‚¨é€‚é…å±‚ä¼šè‡ªåŠ¨é™çº§åˆ°æœ¬åœ°JSONæ–‡ä»¶å­˜å‚¨ï¼Œå¹¶è¾“å‡ºè­¦å‘Šæ—¥å¿—ã€‚

### Q4: åœ°å›¾åŠŸèƒ½å—å­˜å‚¨æ¨¡å¼å½±å“å—ï¼Ÿ
**A**: ä¸å—å½±å“ã€‚åœ°å›¾åŠŸèƒ½ä¸å­˜å‚¨æ¨¡å¼å®Œå…¨è§£è€¦ï¼ŒåŒç¯å¢ƒä¸‹å‡èƒ½æ­£å¸¸ä½¿ç”¨ã€‚

### Q5: å¦‚ä½•ä»localè¿ç§»æ•°æ®åˆ°supabaseï¼Ÿ
**A**: éœ€è¦ç¼–å†™è¿ç§»è„šæœ¬ï¼Œè¯»å–JSONæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ‰¹é‡æ’å…¥åˆ°Supabaseã€‚æˆ–ä½¿ç”¨Supabaseçš„å¯¼å…¥åŠŸèƒ½ã€‚

